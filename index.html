<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zone Management Tool - Accompany Health</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-map-marked-alt"></i>
                    <h1>Zone Management</h1>
                </div>
                <div class="user-info">
                    <i class="fas fa-user-circle"></i>
                    <span>Clinical Operations Manager</span>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="nav-tabs" style="display: none;">
            <!-- Navigation removed - all functionality in Overview -->
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Dashboard View -->
            <div id="dashboard-view" class="view active">
                <div class="view-header">
                    <h2><i class="fas fa-chart-line"></i> Zone Overview</h2>
                    <button class="btn btn-primary" onclick="showCreateZoneModal()">
                        <i class="fas fa-plus"></i> Create Zone
                    </button>
                </div>

                <div class="overview-tabs">
                    <button class="overview-tab active" data-tab="table" onclick="showOverviewTab('table')">
                        <i class="fas fa-table"></i> Zones Table
                    </button>
                    <button class="overview-tab" data-tab="timeline" onclick="showOverviewTab('timeline')">
                        <i class="fas fa-calendar-alt"></i> Coverage Timeline
                    </button>
                </div>

                <div class="dashboard-stats">
                    <div class="stat-card">
                        <div class="stat-icon blue">
                            <i class="fas fa-layer-group"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="total-zones">0</div>
                            <div class="stat-label">Total Zones</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon green">
                            <i class="fas fa-user-md"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="total-providers">0</div>
                            <div class="stat-label">Active Providers</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon orange">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="total-patients">0</div>
                            <div class="stat-label">Total Patients</div>
                        </div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-icon red">
                            <i class="fas fa-exclamation-triangle"></i>
                        </div>
                        <div class="stat-info">
                            <div class="stat-value" id="coverage-gaps">0</div>
                            <div class="stat-label">Coverage Gaps</div>
                        </div>
                    </div>
                </div>

                <div id="overview-table-tab" class="overview-tab-content active">
                    <div class="table-filters">
                        <div class="search-box">
                            <i class="fas fa-search"></i>
                            <input type="text" id="zone-search-filter" placeholder="Search zones by name or ZIP code..." oninput="filterZones()">
                        </div>
                        <div class="filter-options">
                            <label class="filter-checkbox">
                                <input type="checkbox" id="show-gaps-only" onchange="filterZones()">
                                <span>Show only zones with gaps</span>
                            </label>
                            <label class="filter-checkbox">
                                <input type="number" id="gap-days-range" placeholder="Days range" value="60" min="1" max="365" onchange="filterZones()" style="width: 80px; padding: 0.5rem; border: 1px solid var(--border-color); border-radius: 0.25rem; margin-left: 0.5rem;">
                                <span style="margin-left: 0.5rem;">days to check</span>
                            </label>
                        </div>
                    </div>
                    <div class="dashboard-table-container">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Zone Name</th>
                                    <th class="sortable" onclick="sortTable('zipCodes')">
                                        ZIP Codes
                                        <i class="fas fa-sort" id="sort-icon-zipCodes"></i>
                                    </th>
                                    <th class="sortable" onclick="sortTable('patients')">
                                        Members
                                        <i class="fas fa-sort" id="sort-icon-patients"></i>
                                    </th>
                                    <th class="sortable" onclick="sortTable('providers')">
                                        Providers
                                        <i class="fas fa-sort" id="sort-icon-providers"></i>
                                    </th>
                                    <th class="sortable" onclick="sortTable('ratio')">
                                        Members to Providers ratio
                                        <i class="fas fa-sort" id="sort-icon-ratio"></i>
                                    </th>
                                    <th class="sortable" onclick="sortTable('gapDays')">
                                        Days Without Coverage
                                        <i class="fas fa-sort" id="sort-icon-gapDays"></i>
                                    </th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="dashboard-table-body">
                                <!-- Populated by JavaScript -->
                                <tr>
                                    <td colspan="7" style="text-align: center; padding: 2rem; color: #64748b;">
                                        <i class="fas fa-spinner fa-spin"></i> Loading zones...
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div id="overview-timeline-tab" class="overview-tab-content">
                    <div class="overview-timeline-controls">
                        <div class="timeline-controls-row">
                            <div class="control-group">
                                <label>View Range:</label>
                                <select id="overview-timeline-range" onchange="updateOverviewTimeline()">
                                    <option value="30">30 Days</option>
                                    <option value="60" selected>60 Days (2 Months)</option>
                                    <option value="90">90 Days</option>
                                    <option value="custom">Custom Range</option>
                                </select>
                                <div id="overview-custom-range-inputs" class="custom-range-inputs" style="display: none;">
                                    <input type="date" id="overview-custom-start-date">
                                    <input type="date" id="overview-custom-end-date">
                                    <button class="btn btn-primary" onclick="applyOverviewCustomRange()">Apply</button>
                                </div>
                            </div>
                            <div class="control-group">
                                <div class="search-box">
                                    <i class="fas fa-search"></i>
                                    <input type="text" id="timeline-zone-search" placeholder="Search zones..." oninput="updateOverviewTimeline()">
                                </div>
                            </div>
                            <div class="control-group">
                                <label class="filter-checkbox">
                                    <input type="checkbox" id="timeline-show-gaps-only" onchange="updateOverviewTimeline()">
                                    <span>Show only zones with gaps</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    <div id="overview-timeline-container" class="overview-timeline-container">
                        <!-- Populated by JavaScript -->
                    </div>
                </div>
            </div>

            <!-- Zone Detail View (hidden by default) -->
            <div id="zone-detail-view" class="view">
                <div class="view-header">
                    <button class="btn btn-secondary" onclick="showOverview()">
                        <i class="fas fa-arrow-left"></i> Back to Overview
                    </button>
                    <h2 id="zone-detail-name"></h2>
                    <div class="zone-detail-actions">
                        <button class="btn btn-secondary" onclick="editZone()">
                            <i class="fas fa-edit"></i> Edit Zone
                        </button>
                        <button class="btn btn-danger" onclick="deleteZone()">
                            <i class="fas fa-trash"></i> Delete Zone
                        </button>
                    </div>
                </div>

                <div class="zone-detail-tabs">
                    <button class="detail-tab active" data-tab="providers">
                        <i class="fas fa-user-md"></i> Providers Assigned
                    </button>
                    <button class="detail-tab" data-tab="timeline">
                        <i class="fas fa-calendar-alt"></i> Coverage Timeline
                    </button>
                    <button class="detail-tab" data-tab="patients">
                        <i class="fas fa-users"></i> Patients
                    </button>
                </div>

                <div class="zone-detail-content">
                    <!-- Providers Tab -->
                    <div id="providers-tab" class="detail-tab-content active">
                        <div class="tab-header">
                            <h3>Provider Assignments</h3>
                            <button class="btn btn-primary" onclick="showAddProviderModal()">
                                <i class="fas fa-plus"></i> Add Provider
                            </button>
                        </div>
                        <div id="providers-list" class="providers-list">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Timeline Tab -->
                    <div id="timeline-tab" class="detail-tab-content">
                        <div class="timeline-controls">
                            <div class="timeline-controls-row">
                                <div class="control-group">
                                    <label>View Range:</label>
                                    <select id="timeline-range" onchange="updateTimeline()">
                                        <option value="30">30 Days</option>
                                        <option value="60" selected>60 Days (2 Months)</option>
                                        <option value="90">90 Days</option>
                                        <option value="custom">Custom Range</option>
                                    </select>
                                    <div id="custom-range-inputs" class="custom-range-inputs" style="display: none;">
                                        <input type="date" id="custom-start-date">
                                        <input type="date" id="custom-end-date">
                                        <button class="btn btn-primary" onclick="applyCustomRange()">Apply</button>
                                    </div>
                                </div>
                                <div class="control-group">
                                    <div class="search-box">
                                        <i class="fas fa-search"></i>
                                        <input type="text" id="provider-timeline-search" placeholder="Search providers..." oninput="updateTimeline()">
                                    </div>
                                </div>
                                <div class="control-group">
                                    <label class="filter-checkbox">
                                        <input type="checkbox" id="provider-show-gaps-only" onchange="updateTimeline()">
                                        <span>Show only providers with gaps</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                        <div id="timeline-container" class="timeline-container">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>

                    <!-- Patients Tab -->
                    <div id="patients-tab" class="detail-tab-content">
                        <div class="tab-header">
                            <h3>Patients in Zone</h3>
                            <div class="search-box">
                                <i class="fas fa-search"></i>
                                <input type="text" id="patient-search" placeholder="Search by name or ZIP code..." oninput="filterPatients()">
                            </div>
                        </div>
                        <div id="patients-list" class="patients-list">
                            <!-- Populated by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- Modals -->
    <!-- Create/Edit Zone Modal -->
    <div id="zone-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="zone-modal-title">Create Zone</h3>
                <button class="modal-close" onclick="closeModal('zone-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="zone-form">
                    <div class="form-group">
                        <label>Zone Name <span class="required">*</span></label>
                        <input type="text" id="zone-name" placeholder="e.g., North Seattle" required>
                        <div class="error-message" id="zone-name-error"></div>
                    </div>
                    <div class="form-group">
                        <label>ZIP Codes <span class="required">*</span></label>
                        <div class="zip-code-selector">
                            <input type="text" id="zip-search" placeholder="Search or type ZIP code..." oninput="searchZipCodes()">
                            <div id="zip-dropdown" class="zip-dropdown"></div>
                            <div id="selected-zips" class="selected-zips"></div>
                        </div>
                        <div class="error-message" id="zip-codes-error"></div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('zone-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveZone()">
                    <i class="fas fa-save"></i> Save Zone
                </button>
            </div>
        </div>
    </div>

    <!-- Add/Edit Provider Modal -->
    <div id="provider-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="provider-modal-title">Add Provider to Zone</h3>
                <button class="modal-close" onclick="closeModal('provider-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="provider-form">
                    <div class="form-group" id="provider-selector-group">
                        <label>Select Provider(s) <span class="required">*</span></label>
                        <div class="provider-selector">
                            <input type="text" id="provider-search" placeholder="Search providers..." oninput="searchProviders()">
                            <div id="provider-dropdown" class="provider-dropdown"></div>
                            <div id="selected-providers" class="selected-providers"></div>
                        </div>
                        <div class="error-message" id="provider-error"></div>
                    </div>
                    <div class="form-group" id="provider-name-display-group" style="display: none;">
                        <label>Provider</label>
                        <input type="text" id="provider-name-display" readonly>
                    </div>
                    <div class="form-group">
                        <label>Start Date <span class="required">*</span></label>
                        <input type="date" id="provider-start-date" required>
                        <div class="error-message" id="start-date-error"></div>
                    </div>
                    <div class="form-group">
                        <label>End Date <span class="required">*</span></label>
                        <input type="date" id="provider-end-date" required>
                        <div class="error-message" id="end-date-error"></div>
                    </div>
                    <div class="form-group">
                        <label>Active Days <span class="required">*</span></label>
                        <div class="days-selector-modern">
                            <div class="days-quick-select">
                                <button type="button" class="quick-select-btn" onclick="selectAllDays()">
                                    <i class="fas fa-check-double"></i> Select All
                                </button>
                                <button type="button" class="quick-select-btn" onclick="selectWeekdays()">
                                    <i class="fas fa-briefcase"></i> Weekdays Only
                                </button>
                                <button type="button" class="quick-select-btn" onclick="clearAllDays()">
                                    <i class="fas fa-times"></i> Clear All
                                </button>
                            </div>
                            <div class="days-selector-grid">
                                <label class="day-checkbox-modern" data-day="monday">
                                    <input type="checkbox" value="monday" class="day-input" id="provider-monday">
                                    <span class="day-label-modern">Mon</span>
                                </label>
                                <label class="day-checkbox-modern" data-day="tuesday">
                                    <input type="checkbox" value="tuesday" class="day-input" id="provider-tuesday">
                                    <span class="day-label-modern">Tue</span>
                                </label>
                                <label class="day-checkbox-modern" data-day="wednesday">
                                    <input type="checkbox" value="wednesday" class="day-input" id="provider-wednesday">
                                    <span class="day-label-modern">Wed</span>
                                </label>
                                <label class="day-checkbox-modern" data-day="thursday">
                                    <input type="checkbox" value="thursday" class="day-input" id="provider-thursday">
                                    <span class="day-label-modern">Thu</span>
                                </label>
                                <label class="day-checkbox-modern" data-day="friday">
                                    <input type="checkbox" value="friday" class="day-input" id="provider-friday">
                                    <span class="day-label-modern">Fri</span>
                                </label>
                                <label class="day-checkbox-modern" data-day="saturday">
                                    <input type="checkbox" value="saturday" class="day-input" id="provider-saturday">
                                    <span class="day-label-modern">Sat</span>
                                </label>
                                <label class="day-checkbox-modern" data-day="sunday">
                                    <input type="checkbox" value="sunday" class="day-input" id="provider-sunday">
                                    <span class="day-label-modern">Sun</span>
                                </label>
                            </div>
                            <div class="repeat-frequency-selector">
                                <label class="frequency-option">
                                    <input type="radio" name="repeat-frequency" value="weekly" checked>
                                    <span class="frequency-label">
                                        <i class="fas fa-calendar-week"></i>
                                        <span>Weekly</span>
                                    </span>
                                </label>
                                <label class="frequency-option">
                                    <input type="radio" name="repeat-frequency" value="bi-weekly" id="bi-weekly">
                                    <span class="frequency-label">
                                        <i class="fas fa-calendar-alt"></i>
                                        <span>Bi-weekly</span>
                                    </span>
                                </label>
                            </div>
                        </div>
                        <div class="error-message" id="days-error"></div>
                    </div>
                    <div class="form-group">
                        <label>Exception Days (Days when provider is not available)</label>
                        <div id="exception-days-list" class="exception-days-list">
                            <!-- Exception days will be added here -->
                        </div>
                        <button type="button" class="btn btn-secondary btn-sm" onclick="addExceptionDay()" style="margin-top: 0.5rem;">
                            <i class="fas fa-plus"></i> Add Exception Day
                        </button>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('provider-modal')">Cancel</button>
                <button class="btn btn-primary" onclick="saveProviderAssignment()" id="provider-modal-save-btn">
                    <i class="fas fa-save"></i> <span id="provider-modal-save-text">Save Assignment</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Warning/Confirmation Modal -->
    <div id="warning-modal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3 id="warning-title">
                    <i class="fas fa-exclamation-triangle"></i> Warning
                </h3>
                <button class="modal-close" onclick="closeModal('warning-modal')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <p id="warning-message"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeModal('warning-modal')">Cancel</button>
                <button class="btn btn-danger" id="warning-confirm-btn" onclick="confirmWarning()">
                    Continue
                </button>
            </div>
        </div>
    </div>

    <script src="data.js"></script>
    <script src="app.js"></script>
    <script>
        // Ensure dashboard view is visible on load
        window.addEventListener('load', function() {
            const dashboardView = document.getElementById('dashboard-view');
            if (dashboardView) {
                dashboardView.classList.add('active');
            }
            // Check if data loaded
            if (typeof zones === 'undefined') {
                console.error('Error: zones data not loaded. Check data.js file.');
            } else {
                console.log('Zone Management Tool loaded successfully. Zones:', zones.length);
            }
        });
    </script>
</body>
</html>
